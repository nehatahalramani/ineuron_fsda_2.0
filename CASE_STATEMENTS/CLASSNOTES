USE WAREHOUSE DEMO;
USE DATABASE SQLDEMO;

CREATE OR REPLACE TABLE NT_CONSUMER_COMPLAINT
(Date_Received STRING,
 Product_Name VARCHAR(50),
 Sub_Product VARCHAR2(100),
 Issue VARCHAR2(100),
 Sub_Issue VARCHAR2(100),
 Consumer_Complaint_Narrative STRING,
 Company_Public_Response STRING,
 Company VARCHAR2(150),
 State_Name VARCHAR(50),
 Zip_Code STRING,
 Tags VARCHAR(50),
 Consumer_Consent_Provided STRING,
 Submitted_via STRING,
 Date_Sent_to_Company STRING,
 Company_Response_to_Consumer VARCHAR(40),
 Timely_Response CHAR(4),
 Consumer_Disputed CHAR(10),
 Complaint_ID NUMBER(12,0) Not NUll Primary key
);

DESCRIBE TABLE NT_CONSUMER_COMPLAINT;
SELECT * FROM NT_CONSUMER_COMPLAINT;

SELECT DISTINCT SUB_PRODUCT FROM NT_CONSUMER_COMPLAINT;

SELECT DISTINCT SUBMITTED_VIA FROM NT_CONSUMER_COMPLAINT;
SELECT DISTINCT COMPANY_RESPONSE_TO_CONSUMER FROM NT_CONSUMER_COMPLAINT;

--if want to show all columns use *
SELECT *,
    CASE WHEN SUBMITTED_VIA IN ('Email','Postal mail','Referral') THEN 'OUTBOUND'
         WHEN SUBMITTED_VIA IN ('Phone','Web') THEN 'INBOUND'
         ELSE 'ELECTRONIC'
    END AS SUBMITTED_NEW
    
FROM NT_CONSUMER_COMPLAINT;


SELECT SUBMITTED_VIA,Sub_Product FROM NT_CONSUMER_COMPLAINT;

--if want to show particular columns name column names 

SELECT  PRODUCT_NAME,ISSUE,COMPANY,SUBMITTED_VIA,
    CASE WHEN SUBMITTED_VIA IN ('Email','Postal mail','Referral') THEN 'OUTBOUND'
         WHEN SUBMITTED_VIA IN ('Phone','Web') THEN 'INBOUND'
         ELSE 'ELECTRONIC'
    END AS SUBMITTED_NEW
        
FROM NT_CONSUMER_COMPLAINT;

SELECT PRODUCT_NAME, 
    CASE WHEN UPPER(PRODUCT_NAME) LIKE '%LOAN' THEN 'LOAN'
         WHEN (PRODUCT_NAME) IN ('Credit card','Credit reporting','Debt collection','Money transfers','Mortgage','Prepaid card') THEN 'CARDS'
    ELSE 'OTHERS'
    END AS NEW_PRODUCT
FROM NT_CONSUMER_COMPLAINT;

--if uh need to use NULL uh have to use IS before that (SUB_PRODUCT IS NULL)
SELECT SUB_PRODUCT,
    CASE WHEN UPPER(SUB_PRODUCT) LIKE '%LOAN%' THEN 'LOAN'
         WHEN UPPER(SUB_PRODUCT) LIKE '%CARD%' THEN 'CARD'
         WHEN SUB_PRODUCT= 'I do not know'OR SUB_PRODUCT IS NULL THEN 'NA'
         WHEN UPPER(SUB_PRODUCT) LIKE '%MORTGAGE%' THEN 'MORTGAGE'
     ELSE SUB_PRODUCT
     END AS SUB_PRODUCT_TYPE
FROM NT_CONSUMER_COMPLAINT;


SELECT COMPANY_RESPONSE_TO_CONSUMER,
    CASE WHEN COMPANY_RESPONSE_TO_CONSUMER = 'Closed with explanation' THEN 'EXPLAIN'
        WHEN COMPANY_RESPONSE_TO_CONSUMER ='Closed with monetary relief' THEN 'MONETARY RELIEF'
        WHEN COMPANY_RESPONSE_TO_CONSUMER IN ('Closed with non-monetary relief','Closed') THEN 'CLOSED'
    ELSE COMPANY_RESPONSE_TO_CONSUMER
    END AS COMPANY_NEW_RESPONSE
FROM NT_CONSUMER_COMPLAINT;


--CREATING VIEW 

CREATE OR REPLACE VIEW NT_CONSUMER_COMPLAINT_VIEW AS 
SELECT  PRODUCT_NAME,ISSUE,COMPANY,SUBMITTED_VIA,SUB_PRODUCT, COMPANY_RESPONSE_TO_CONSUMER,
    CASE WHEN SUBMITTED_VIA IN ('Email','Postal mail','Referral') THEN 'OUTBOUND'
         WHEN SUBMITTED_VIA IN ('Phone','Web') THEN 'INBOUND'
         ELSE 'ELECTRONIC'
    END AS SUBMITTED_NEW,
    
    CASE WHEN UPPER(PRODUCT_NAME) LIKE '%LOAN' THEN 'LOAN'
         WHEN (PRODUCT_NAME) IN ('Credit card','Credit reporting','Debt collection','Money transfers','Mortgage','Prepaid card') THEN 'CARDS'
    ELSE 'OTHERS'
    END AS NEW_PRODUCT,
    
    CASE WHEN UPPER(SUB_PRODUCT) LIKE '%LOAN%' THEN 'LOAN'
         WHEN UPPER(SUB_PRODUCT) LIKE '%CARD%' THEN 'CARD'
         WHEN SUB_PRODUCT= 'I do not know'OR SUB_PRODUCT IS NULL THEN 'NA'
         WHEN UPPER(SUB_PRODUCT) LIKE '%MORTGAGE%' THEN 'MORTGAGE'
     ELSE SUB_PRODUCT
     END AS SUB_PRODUCT_TYPE,
     
     CASE WHEN COMPANY_RESPONSE_TO_CONSUMER = 'Closed with explanation' THEN 'EXPLAIN'
        WHEN COMPANY_RESPONSE_TO_CONSUMER ='Closed with monetary relief' THEN 'MONETARY RELIEF'
        WHEN COMPANY_RESPONSE_TO_CONSUMER IN ('Closed with non-monetary relief','Closed') THEN 'CLOSED'
    ELSE COMPANY_RESPONSE_TO_CONSUMER
    END AS COMPANY_NEW_RESPONSE
    
FROM NT_CONSUMER_COMPLAINT;

SELECT * FROM NT_CONSUMER_COMPLAINT_VIEW;
